# Web App

## Updating the Authorization Token 

> The Oauth2 Token used to authenticate the user to the Salesforce Org `e2edemo` will expire. There are mechanisms to handle a refresh token, but are not correctly working at the moment. As a work around there is a process to manually create and update the required Authorization token. These instructions are provided below. 
-------

Dependencies 
- [ ] You will need a means to execute `git` commands and `git pushes` to this repo
- [ ] You will need Postman or `cUrl`

### Steps: 

Within this repository you will need to update the `testConf/public/js/main.js` file on the `master` branch . There are several ways to do this for the sake of simplicity, the easiest way to do this is simply to edit the file directly from the Github UI. The information you will update Github with will come from Postman. We will therefore explain the process in the context of `1. What to do in Postman` & `2. What to do in Github`

--------

#### 1. What to do in Postman

1. All the API calls associated with the `End2End` Demo, have been captured in a `Postman Collection` labeled `End2End` which can be downloaded from [here](https://drive.google.com/file/d/1R6dWAIBV-SXCQXxPB5GfAEDXGYDZHtk-/view?usp=sharing). Download the Postman Collection. 

2. Open `Postman` and select the _Import_ button. Follow the wizard prompts to source the file and import the collection. 

<p align="center"><img src="https://user-images.githubusercontent.com/8760590/135658352-54cd46d3-5258-4353-8976-b2febdd3444a.png" width="250"/></p>

3. Once imported you will need to use the request labeled `POST Auth Token` to get the required `access_token` that will be used in later steps. In Postman, click on this request. 

<p align="center"><img src="https://user-images.githubusercontent.com/8760590/135659047-fbc64eec-1075-4efd-985f-20b21a220567.png" width="250"/></p>

4. In the configuration screen the environment variables and body parameters should already be configured for you to make a successful request. Validate the following from the screenshot below, and click "Send".

<p align="center"><img src="https://user-images.githubusercontent.com/8760590/135659677-2323935a-2f3f-485e-8f3b-9e259d27fecb.png" width="250"/></p>

> __NOTE:__ The `Salesforce e2e Org` that is being used and the profile associated with _Username e2edemo@provartesting.com_ is __SHARED__. As a result it maybe that a shared user resets the Security Token on the Salesforce Org rendering the token depicted here as obsolete. This matters because the _Password_ parameter circled in Green is a concatinated string. The first portion _Provar2022_ is the _password_ which can change on a password reset. But also, and more likely to change are the remaining characters which are the `Security Token`. If you are receiving an message `error: invalid grant` -- more than likely someone has changed the security token. You can find the Security Token autogenerated emails in the `# poc_emails` channel on Slack. If you update the security token portion of this entire string, the error should resolve. All other items circle in pink are static and should not change.

5. In a successful response you will see a JSON payload returned with the access token. This token is what you will need to Copy so we can complete the next step. 
<p align="center"><img src="https://user-images.githubusercontent.com/8760590/135661269-947b7eb8-781d-4156-a3fd-72f757cd2d4b.png" width="250"/></p>

----------

#### 2. What to do in Github

1. First make sure you on the `master` branch and use the UI to navigate to `/public/js/main.js` file

<p align="center"><img src="https://user-images.githubusercontent.com/8760590/135657297-779e37ad-0c00-4976-a2d4-409ed1f5f3f6.png" width="250"/></p>

2. Here you can click the `pencil` (edit) button from the UI and make the required update. Click the pencil. 

3. The UI will go into editor mode. Once in editor mode you need to delete the string following the word `SF_BEARER_TOKEN`. 

4. Paste the new access_token string you received from Postman here in this file. 

5. Scroll to the bottom of the UI and you will see a button to `Commit Changes`. No need to add any comments. Leave all default. Click this button. 

<p align="center"><img src="https://user-images.githubusercontent.com/8760590/135662517-3a2234a8-152b-4cc7-bef9-fe51af93f3cc.png" width="250"/></p>

----------

#### 3. What happens now? 

There is an event listener, listening to the `master` branch of this repo on an AWS Code Pipeline. The pipeline will compile the changes and deploy to our target `www.testconfdemo.com` environment. So after making the updates above, there will need to be ~ 30 seconds to  account for the pipeline build. 

<p align="center"><img src="https://user-images.githubusercontent.com/8760590/135663172-61e3b51c-6ddc-49c0-b739-6a8fbd3baffa.png" width="250"/></p>

You can then process the demo. You can validate requests are occuring on the `https://www.testconfdemo.com/form#` by opening the Google Chrome developer tools on this page. On window load an initial request will fire -- the request will fail, but that is okay its just making the initial connection using `jsforce`. You can now populate the form with data and click "Submit". The console output of the Developer Tools should render a successful request signifying the an update has been made to Salesforce Org. 

<p align="center"><img src="https://user-images.githubusercontent.com/8760590/135664152-458aa11e-73f1-4b58-ad9a-f52cb7e939ae.png" width="250"/></p>
